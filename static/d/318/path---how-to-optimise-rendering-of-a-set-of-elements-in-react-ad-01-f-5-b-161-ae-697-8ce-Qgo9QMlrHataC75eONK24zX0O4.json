{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABFUlEQVQY023PvUrDUBTA8ZuCtoMoOLQ4dWhN14x2kEKXFkGoohQ/QBexOHRycAidKkgHHRq69APRoTjFJYODIA6+gSBYfYMmfYLE/5VT6NALP845NyeHc9UoCHZRQvonCLKKE4ZhAXYURTsYoE9dIy5iCzfUJnEdV+RF4iu6ikFH2EPxazzOcJmg4Rnn5C8ysIEOHqTe5/sT3qXOwYOtRr5/wLAqzpCTDXu4p2ETtyjgGJ/cX+se8jeU9fa4RBt5vWENpjzdkoGPcGg4RQsbOMEFmnBRRwVDHEK/yFXfvr/CoPjvZLKcdByDyzWGeajigzorGy0oOeRJiUtITe/pX1XzDk3buIMltSFR/zTtic3060X+8z8PsEUt8G3LVQAAAABJRU5ErkJggg==","width":400,"height":128,"src":"/static/ghost-logo-2b5eaa0de166a8b5faebad4955c2200c-51380.png","srcSet":"/static/ghost-logo-2b5eaa0de166a8b5faebad4955c2200c-51380.png 1x"}}},"markdownRemark":{"html":"<h1>Tips to optimise rendering of a set of elements in React</h1>\n<p>There is a guide to increase React performance. The advanced tip will increase speed by 20 times.</p>\n<p>Rendering a list of some elements in a page is a common task for almost any web-app. In this post I would like to show how to improve performance for that case.</p>\n<p>For a test example we will create app that draws a set of targets (circles) on the <code class=\"language-text\">&lt;canvas&gt;</code> element. I will use Redux for a data storage. But these tips can be applied for many other state managing approaches. Also, you can use these tips with react-redux, but for a clear explanation I will not use it.</p>\n<p>Let me start from store definition.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">generateTargets</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">times</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            id<span class=\"token punctuation\">:</span> i<span class=\"token punctuation\">,</span>\n            x<span class=\"token punctuation\">:</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">,</span>\n            y<span class=\"token punctuation\">:</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> window<span class=\"token punctuation\">.</span>innerHeight<span class=\"token punctuation\">,</span>\n            radius<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span> <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n            color<span class=\"token punctuation\">:</span> Konva<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span><span class=\"token function\">getRandomColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// for test case our logic will be very simple</span>\n<span class=\"token comment\">// just one action UPDATE for updating radius of a target</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">appReducer</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'UPDATE'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n       <span class=\"token keyword\">const</span> i <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">findIndex</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">.</span>targets<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> t<span class=\"token punctuation\">.</span>id <span class=\"token operator\">===</span> action<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token keyword\">const</span> updatedTarget <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n           <span class=\"token operator\">...</span>state<span class=\"token punctuation\">.</span>targets<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n           radius<span class=\"token punctuation\">:</span> action<span class=\"token punctuation\">.</span>radius\n       <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n       state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n           targets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n               <span class=\"token operator\">...</span>state<span class=\"token punctuation\">.</span>targets<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n               updatedTarget<span class=\"token punctuation\">,</span>\n               <span class=\"token operator\">...</span>state<span class=\"token punctuation\">.</span>targets<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n           <span class=\"token punctuation\">]</span>\n       <span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">}</span>\n   <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> initialState <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    targets<span class=\"token punctuation\">:</span> <span class=\"token function\">generateTargets</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// create redux store</span>\n<span class=\"token keyword\">const</span> store <span class=\"token operator\">=</span> Redux<span class=\"token punctuation\">.</span><span class=\"token function\">createStore</span><span class=\"token punctuation\">(</span>appReducer<span class=\"token punctuation\">,</span> initialState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then define our application rendering. I will use <a href=\"https://konvajs.github.io/docs/react/\" target=\"_blank\">react-konva</a> for canvas rendering.</p>\n<p>The result of this application will be:</p>\n<p>Now let’s create a simple test script that will run several updates on one target:</p>\n<p>Let’s run test script for the app without any optimisations. On my machine, an update will take ~21ms.</p>\n<p>Time for rendering without optimisation\nThis time doesn’t include canvas drawing, only redux + react code because react-konva is drawing objects only on the next animation frame tick. We are not interested in a canvas optimisation right now, it can be a subject of another post.</p>\n<p>So ~21ms for 1000 elements is pretty good performance. If we update elements rarely we can keep this code the way it is.</p>\n<p>But I had a case where I need to execute update very frequently (on every mouse move during drag&#x26;drop). For 60 FPS animation, each update should take no more than 16ms. So 21ms is not so good for this case (plus will have canvas drawing).</p>\n<p>How can we optimise rendering?</p>\n<p>1 Don’t update unchanged elements\nThis is a first rule to improve React performance. All we need is to implement <code class=\"language-text\">shouldComponentUpdate</code> for Target Element:</p>\n<p>Result for this update (<a href=\"http://codepen.io/lavrton/pen/XdPGqj\">http://codepen.io/lavrton/pen/XdPGqj</a>):</p>\n<p>Time for rendering with a simple classic optimisation\nWow. ~4ms vs 21ms. This is much better. But can we do more? In my real app even after this optimisation the performance was bad.</p>\n<p>Advanced tuning\nNow take a look into “render()” function of App component. The thing I don’t like in this code is that <code class=\"language-text\">render()</code> of app component will be called on EACH update.</p>\n<p>That means we have more that 1000 calls for React.createElement for each target. In this case, it works fast but in larger apps it can be slow.</p>\n<p>Why should we rerender the whole list if we know that only particular components are updated? Can we just directly update them?</p>\n<p>2 Make child components smarter\nThe idea is simple:</p>\n<p>Don’t update the app component if a list has the same number of elements and order of elements is the same\nChildren components should update itself if data is changed\nSo “Target” component should subscribe to store and track changes:</p>\n<p>And implement “shouldComponentUpdate” for App component:</p>\n<p>Result after that changes (<a href=\"http://codepen.io/lavrton/pen/bpxZjy\">http://codepen.io/lavrton/pen/bpxZjy</a>):</p>\n<p>Time for rendering with an advanced optimisation\n0.25ms for an update is much better now.</p>\n<p>Bonus tip\nUse <a href=\"https://github.com/mobxjs/mobx\">https://github.com/mobxjs/mobx</a> to skip all of this subscribing code. Same app using mobx (<a href=\"http://codepen.io/lavrton/pen/WwPaeV\">http://codepen.io/lavrton/pen/WwPaeV</a>):</p>\n<p>Time for rendering with mobx state\nAbout 1.5x faster than the previous result (and difference will be much more if you have more elements). And code is much simpler:</p>\n<p>Do you have performance issues with your web-app? I can help you.</p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Tips to optimise rendering of a set of elements in React"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is a guide to increase React performance. The advanced tip will increase speed by 20 times."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Rendering a list of some elements in a page is a common task for almost any web-app. In this post I would like to show how to improve performance for that case."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For a test example we will create app that draws a set of targets (circles) on the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"<canvas>"}]},{"type":"text","value":" element. I will use Redux for a data storage. But these tips can be applied for many other state managing approaches. Also, you can use these tips with react-redux, but for a clear explanation I will not use it."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let me start from store definition."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"generateTargets"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" _"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"times"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1000"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"i"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            id"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" i"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n            x"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Math"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"random"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"*"}]},{"type":"text","value":" window"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"innerWidth"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n            y"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Math"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"random"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"*"}]},{"type":"text","value":" window"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"innerHeight"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n            radius"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" Math"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"random"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"*"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n            color"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Konva"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"Util"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getRandomColor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// for test case our logic will be very simple"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// just one action UPDATE for updating radius of a target"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"appReducer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"state"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" action"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n   "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"action"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"type "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"==="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'UPDATE'"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n       "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" i "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" _"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findIndex"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"state"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"targets"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"t"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"=>"}]},{"type":"text","value":" t"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"id "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"==="}]},{"type":"text","value":" action"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"id"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n       "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" updatedTarget "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n           "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"..."}]},{"type":"text","value":"state"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"targets"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"i"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n           radius"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" action"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"radius\n       "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n       state "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n           targets"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"\n               "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"..."}]},{"type":"text","value":"state"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"targets"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"slice"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" i"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n               updatedTarget"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n               "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"..."}]},{"type":"text","value":"state"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"targets"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"slice"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"i "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n           "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n       "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n   "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n   "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" state"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" initialState "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    targets"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"generateTargets"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// create redux store"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" store "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" Redux"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"createStore"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"appReducer"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" initialState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Then define our application rendering. I will use "},{"type":"element","tagName":"a","properties":{"href":"https://konvajs.github.io/docs/react/","target":"_blank"},"children":[{"type":"text","value":"react-konva"}]},{"type":"text","value":" for canvas rendering."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The result of this application will be:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now let’s create a simple test script that will run several updates on one target:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let’s run test script for the app without any optimisations. On my machine, an update will take ~21ms."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Time for rendering without optimisation\nThis time doesn’t include canvas drawing, only redux + react code because react-konva is drawing objects only on the next animation frame tick. We are not interested in a canvas optimisation right now, it can be a subject of another post."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So ~21ms for 1000 elements is pretty good performance. If we update elements rarely we can keep this code the way it is."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But I had a case where I need to execute update very frequently (on every mouse move during drag&drop). For 60 FPS animation, each update should take no more than 16ms. So 21ms is not so good for this case (plus will have canvas drawing)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"How can we optimise rendering?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"1 Don’t update unchanged elements\nThis is a first rule to improve React performance. All we need is to implement "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"shouldComponentUpdate"}]},{"type":"text","value":" for Target Element:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Result for this update ("},{"type":"element","tagName":"a","properties":{"href":"http://codepen.io/lavrton/pen/XdPGqj"},"children":[{"type":"text","value":"http://codepen.io/lavrton/pen/XdPGqj"}]},{"type":"text","value":"):"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Time for rendering with a simple classic optimisation\nWow. ~4ms vs 21ms. This is much better. But can we do more? In my real app even after this optimisation the performance was bad."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Advanced tuning\nNow take a look into “render()” function of App component. The thing I don’t like in this code is that "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"render()"}]},{"type":"text","value":" of app component will be called on EACH update."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"That means we have more that 1000 calls for React.createElement for each target. In this case, it works fast but in larger apps it can be slow."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Why should we rerender the whole list if we know that only particular components are updated? Can we just directly update them?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"2 Make child components smarter\nThe idea is simple:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Don’t update the app component if a list has the same number of elements and order of elements is the same\nChildren components should update itself if data is changed\nSo “Target” component should subscribe to store and track changes:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And implement “shouldComponentUpdate” for App component:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Result after that changes ("},{"type":"element","tagName":"a","properties":{"href":"http://codepen.io/lavrton/pen/bpxZjy"},"children":[{"type":"text","value":"http://codepen.io/lavrton/pen/bpxZjy"}]},{"type":"text","value":"):"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Time for rendering with an advanced optimisation\n0.25ms for an update is much better now."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bonus tip\nUse "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/mobxjs/mobx"},"children":[{"type":"text","value":"https://github.com/mobxjs/mobx"}]},{"type":"text","value":" to skip all of this subscribing code. Same app using mobx ("},{"type":"element","tagName":"a","properties":{"href":"http://codepen.io/lavrton/pen/WwPaeV"},"children":[{"type":"text","value":"http://codepen.io/lavrton/pen/WwPaeV"}]},{"type":"text","value":"):"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Time for rendering with mobx state\nAbout 1.5x faster than the previous result (and difference will be much more if you have more elements). And code is much simpler:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Do you have performance issues with your web-app? I can help you."}]}],"data":{"quirksMode":false}},"excerpt":"Tips to optimise rendering of a set of elements in React There is a guide to increase React performance. The advanced tip will increase…","timeToRead":3,"frontmatter":{"title":"Tips to optimise rendering of a set of elements in React","userDate":"11 May 2016","date":"2016-05-11","tags":["react","performance"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADc0lEQVQ4yz2TaU+bVxBG35/WH9BIldoPaZqQsoODbbyweAUveDfGGGxqNoNZo0AIuE0DIVCkEMBAA7SAkpS0RAgH7OCQEgSmnF6o1CuNNB/uPfeZmWckc40cr8NEo9eK11WPrlqJrLSAssJ8SvO/Q1l+G3nJVyjK72C3GLHVGQn63TitRup0KnQaGVpFAaqKfBRleUgaWTG6yjIc9bU0NTpp9Dsx6LQCWkTx93cpL8yjVn2LKlUh1nqT+LSBUJOPBouBWq2MalUxNepSNMoiKisKkRzeCBarC0OtDkONFotZj8vZQIPdTpVGi0ImR6eV43YqMRqM+Dw+PA4nJl2leKPApFdjFEqvcn11BdLQwxGGxiaIP3hER3yYQHMEh8ODxxOgNdxBpK0Tr9dPg60Ko74MtVIl1KpF6XrcLhtOhwWH3YTNUkudSYs0kRgh8XiMqZmnPF9aYW1zh99f7bK6tsnCYpKVl2usri8T641xr6yIb7+5gVx2j5ZQC62tIZpDAfx+F263TVRlRvr5yQTPZqdZSq7y29YOb3cPyGQ/kbvIkcvlOMpmSWfSvNn5g4HhhFAUEb300NMbpzsWIyaiq7tLVNJKsDmANPn0MYvJJH/t7pM5OuHgMMt+KsX+fopM5oiTk89cXPzD6zc7xDp7KL1bSLW6hpHRcQYGh+nrH6C3r4+4iP7BIaTkyhLrGxskl17ybGae5ZX1a+DZ+TlX5/Lykr29Xeamxxntj1B06yZ1Ynj9fYPcfzDK4NB9enp6+CHaRjjSgtQcbBJSo4wnZoXKlADw/7nK0+n3LCfn+XVxirXlWczCp9XyQsIBH9G2dgEcvi67rS1CqCWI1BkfZ/PVPue5/yDn5xcictewjOjd5uYav0yLgc08YmvjBU3C/AZNOTrhu6DXRaOwUXt7VDgiRCDgR9p+/SfZ7EdOT884Pj7l5O8zLgQ4lUqzMD/H4ovnTIw8ZHSwW6icFMqER81alCV5GFRF+J126vR6/D43/oAHKZP+wNGHY969OyD1/iOfBW13L81PiSmGBwaYfjJHRyhMm7icGOmlo7URbUUJhiold77+En1lPi6rCY28QiyFAenw8Ij1tW22t96SFgo/CeDU5ALRcCdd0S5+HJvGZ7XjMtcQjzbTGQ6iKBFrVl5MgRjQzRtfYDPIrne8JO82/wKfkvOM+YYXvQAAAABJRU5ErkJggg==","aspectRatio":1.5,"src":"/static/react-perf-cover-fc2112a7c2685ea5d18f32c0f6479cc7-2fdd9.png","srcSet":"/static/react-perf-cover-fc2112a7c2685ea5d18f32c0f6479cc7-70339.png 930w,\n/static/react-perf-cover-fc2112a7c2685ea5d18f32c0f6479cc7-2fdd9.png 1200w","sizes":"(max-width: 1200px) 100vw, 1200px"}}},"author":null}},"relatedPosts":{"totalCount":2,"edges":[{"node":{"id":"9f93c31f-d13b-592d-82f0-e4232942a934","timeToRead":5,"excerpt":"How to use React with canvas element? We have React that helps us to work with massive mutable DOM in a nice immutable functional style…","frontmatter":{"title":"Using React With Canvas Element"},"fields":{"slug":"/using-react-with-html6-canvas-871d07d8d753/"}}},{"node":{"id":"e94d0e07-9eab-5c8c-aef6-145d021dbd55","timeToRead":3,"excerpt":"Tips to optimise rendering of a set of elements in React There is a guide to increase React performance. The advanced tip will increase…","frontmatter":{"title":"Tips to optimise rendering of a set of elements in React"},"fields":{"slug":"/how-to-optimise-rendering-of-a-set-of-elements-in-react-ad01f5b161ae/"}}}]}},"pageContext":{"slug":"/how-to-optimise-rendering-of-a-set-of-elements-in-react-ad01f5b161ae/","prev":{"excerpt":"How to use React with canvas element? We have React that helps us to work with massive mutable DOM in a nice immutable functional style…","timeToRead":5,"frontmatter":{"title":"Using React With Canvas Element","tags":["react","canvas"],"date":"2016-02-01","image":{"childImageSharp":{"fluid":{"aspectRatio":1.5,"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACQ0lEQVQ4yz2TWW/TUBCF83eRkHjgAQEpUlVKRVEaCNC0CtnsOE7ShggRsjorFJ6p4i0b8EsOM8d2HkZ37vW935xZnArGBtYTC2unxnUzb2IzteGN5HzWQDBtIJy1sFncwp+o38R63kIwsaNvYsGkDt+xaCmCpnXCQsekv5lFlwK54I5rBKwFqgDCEhDNliDRGjh1pMJRFTSBqdpQAoT6UYCewLyRyb0+OkBUXawwUUegnKWCYQmJynAsj0VpoKucKdAdVOHLqpcjqE3zNYMk8KjGbNRnypupRcCGtRSlwyrue2WCt1oCsa3UViHrGLpdtFjvtdR0v7wRQVGglNZuNajg5sMxMk8f4G36IayLNMzMczjGBRwzi2XjPerZIxiZNC5PHqOWfYHC2RNkjx6hdP4MX4vn+N2rEppSZat+BUs7h8+XJ3zYLZxhIqBft3nctT7ieyOHTv4lOlenaOdP4Vjv0L56BTt3jC+F1+gW3+C+r32QLvuSXsjULOxndTELO/HZda2ljpUE3c1s7OcN7BdN7CTFv3cd/PvZwZ8fbewk/VCbMxZgIB1W8yRtt18WK4kv+6EhDalwjfz4rK9npnRWmiJz6UuzXN2P46b4wwr8QRmegOiLeQRJd2Vk1BKomp+s7Hyd4MTn2BBElUYM0MsmLxEm5g5iYPzdiwPx71BlVBsDI1WSTq8It/eJD5KZ4qNhFEhHKPKNg3Iq07tOAuVgV1h491sBq+61QItUy8GOFYX6kIoNloL1ZM213uVDVtqY/6UbNetwA7CrAAAAAElFTkSuQmCC","sizes":"(max-width: 1200px) 100vw, 1200px","src":"/static/react-canvas-cover-885823f06d394ab1dc1eb96b5677cd18-2fdd9.png","srcSet":"/static/react-canvas-cover-885823f06d394ab1dc1eb96b5677cd18-70339.png 930w,\n/static/react-canvas-cover-885823f06d394ab1dc1eb96b5677cd18-2fdd9.png 1200w"}}},"author":{"id":"Ghost","bio":"The professional publishing platform","avatar":{"children":[{"fixed":{"src":"/static/ghost-5f2c129e42248a92c87b13b4293950cf-fba88.png"}}]}}},"fields":{"layout":"post","slug":"/using-react-with-html6-canvas-871d07d8d753/"}},"next":null,"primaryTag":"react"}}